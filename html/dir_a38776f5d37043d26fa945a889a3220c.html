<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Arkanjo: arkanjo/third-party/duplicate-code-detection-tool Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Arkanjo<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">A tool for find code duplicated functions in codebases</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_a38776f5d37043d26fa945a889a3220c.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">duplicate-code-detection-tool Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Directory dependency graph for duplicate-code-detection-tool:</div>
<div class="dyncontent">
<div class="center"><img src="dir_a38776f5d37043d26fa945a889a3220c_dep.png" border="0" usemap="#adir__a38776f5d37043d26fa945a889a3220c__dep" alt="arkanjo/third-party/duplicate-code-detection-tool"/></div>
<map name="adir__a38776f5d37043d26fa945a889a3220c__dep" id="adir__a38776f5d37043d26fa945a889a3220c__dep">
<area shape="rect" href="dir_a38776f5d37043d26fa945a889a3220c.html" title="duplicate&#45;code&#45;detection&#45;tool" alt="" coords="26,52,214,78"/>
<area shape="rect" href="dir_52d0f11198f0068e2be6e37fca9a566b.html" title="third&#45;party" alt="" coords="16,16,224,89"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="duplicate__code__detection_8py_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="duplicate__code__detection_8py.html">duplicate_code_detection.py</a></td></tr>
<tr class="memdesc:duplicate__code__detection_8py"><td class="mdescLeft">&#160;</td><td class="mdescRight">A simple Python3 tool to detect similarities between files within a repository. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="run__action_8py_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="run__action_8py.html">run_action.py</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="setup_8py_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8py.html">setup.py</a></td></tr>
<tr class="memdesc:setup_8py"><td class="mdescLeft">&#160;</td><td class="mdescRight">Package configuration for duplicate code detection tool. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>A simple Python3 tool (also available as a GitHub Action) to detect similarities between files within a repository.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
What?</h1>
<p>A command line tool that receives a directory or a list of files and determines the degree of similarity between them.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Why?</h1>
<p>The tool intends guide the refactoring efforts of a developer who wishes to reduce code duplication within a component and improve its software architecture.</p>
<p>Its development was initiated within the context of the <a href="https://pingpong.chalmers.se/public/courseId/9754/lang-en/publicPage.do">DAT265 - Software Evolution Project</a>.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
How?</h1>
<p>The tool uses the <a href="https://radimrehurek.com/gensim/">gensim</a> Python library to determine the similarity between source code files, supplied by the user. The default supported languages are C, C++, JAVA, Python and C#.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Dependencies</h2>
<p>The following Python packages have to be installed:</p><ul>
<li>nltk<ul>
<li><code>pip3 install --user nltk</code></li>
</ul>
</li>
<li>gensim<ul>
<li><code>pip3 install --user gensim</code></li>
</ul>
</li>
<li>astor<ul>
<li><code>pip3 install --user astor</code></li>
</ul>
</li>
<li>punkt<ul>
<li><code>python3 -m nltk.downloader punkt</code></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md15"></a>
Get started</h1>
<p>Suppress the warnings (generated by the used libraries) as <code>python3 -W ignore <a class="el" href="duplicate__code__detection_8py.html" title="A simple Python3 tool to detect similarities between files within a repository.">duplicate_code_detection.py</a></code> and then supply the necessary arguments. More details can be found by running the tool with the <code>--help</code> option.</p>
<p><b>Notice:</b> Due to the way the models are created, the more source files you provide the tool the more accurate the similarity calculations are. In other words, the bigger the project, the more useful the tool is.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Example</h2>
<p>If <code>duplicate-code-detection-tool</code> is the name where the tool resides in and <code>smartcar_shield/src</code> contains the repository you want to check for source code similarities between the files, then you can run the following to get the similarity report:</p>
<p><code>python3 -W ignore <a class="el" href="duplicate__code__detection_8py.html" title="A simple Python3 tool to detect similarities between files within a repository.">duplicate-code-detection-tool/duplicate_code_detection.py</a> -d smartcar_shield/src/</code></p>
<p>The result should look something like this:</p>
<p><img src="https://i.imgur.com/wi1TnVM.png" alt="code duplication tool screenshot" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md17"></a>
GitHub Action</h1>
<p>The tool is also available as a <a href="https://docs.github.com/en/actions">GitHub Action</a> for easy integration with projects hosted on GitHub. An example output of the tool can be seen <a href="https://github.com/platisd/smartcar_shield/pull/36#issuecomment-778635111">here</a>.</p>
<p>The Action is meant to be triggered during <b>pull requests</b> to give the developers an impression over the <b>degree of similarity</b> between the files in the source code. Below you will find a sample workflow files that illustrate the usage.</p>
<p>Depending on the <em>size</em> of your project, you may want to have the tool running multiple times (i.e in diffferent steps) that test specific parts of your repository for duplicate code. This way you will not compare each file in your codebase with everything else and get back more meaningful reports.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Bare minimum</h2>
<p>In the following example the tool will examine source code (the languages supported by default) in the <code>src/</code> and <code>test/ut</code> directories <em>relative</em> to the root directory of your repository. The results will be posted as a comment in the <b>pull request</b> that was opened.</p>
<div class="fragment"><div class="line">name: Duplicate code</div>
<div class="line"> </div>
<div class="line">on: pull_request</div>
<div class="line"> </div>
<div class="line">jobs:</div>
<div class="line">  duplicate-code-check:</div>
<div class="line">    name: Check for duplicate code</div>
<div class="line">    runs-on: ubuntu-20.04</div>
<div class="line">    steps:</div>
<div class="line">      - name: Check for duplicate code</div>
<div class="line">        uses: platisd/duplicate-code-detection-tool@master</div>
<div class="line">        with:</div>
<div class="line">          github_token: ${{ secrets.GITHUB_TOKEN }}</div>
<div class="line">          directories: &quot;src/, test/ut&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
Trigger on pull request comment</h2>
<p>If you want to avoid the "spam" you should configure the tool to not always run. Specifically, if you wish to trigger the Action manually, you can do so by leaving a comment in the pull request.</p>
<p>The following action will trigger the tool to be run when a comment containig <code>run_duplicate_code_detection_tool</code> is posted in a pull request. The tool will run using the code in the pull request.</p>
<div class="fragment"><div class="line">name: Duplicate code</div>
<div class="line"> </div>
<div class="line">on: issue_comment</div>
<div class="line"> </div>
<div class="line">jobs:</div>
<div class="line">  duplicate-code-check:</div>
<div class="line">    name: Check for duplicate code</div>
<div class="line">    # Trigger the tool only when a comment containing the keyword is published in a pull request</div>
<div class="line">    if: github.event.issue.pull_request &amp;&amp; contains(github.event.comment.body, &#39;run_duplicate_code_detection_tool&#39;)</div>
<div class="line">    runs-on: ubuntu-20.04</div>
<div class="line">    steps:</div>
<div class="line">      - name: Check for duplicate code</div>
<div class="line">        uses: platisd/duplicate-code-detection-tool@master</div>
<div class="line">        with:</div>
<div class="line">          github_token: ${{ secrets.GITHUB_TOKEN }}</div>
<div class="line">          directories: &quot;.&quot;</div>
</div><!-- fragment --><p><b>Important:</b> Please note that due to the way GitHub Actions work, you will <em>first</em> have to merge this into your main branch so it starts taking effect.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Optional configuration</h2>
<p>It may not make sense to compare all files or get a files with very low similarity reported. In the following workflow, the different <em>optional</em> arguments are demonstrated.</p>
<p>For the various default values, please consult <a href="action.yml">action.yml</a>.</p>
<div class="fragment"><div class="line">name: Duplicate code</div>
<div class="line"> </div>
<div class="line">on: pull_request</div>
<div class="line"> </div>
<div class="line">jobs:</div>
<div class="line">  duplicate-code-check:</div>
<div class="line">    name: Check for duplicate code</div>
<div class="line">    runs-on: ubuntu-20.04</div>
<div class="line">    steps:</div>
<div class="line">      - name: Check for duplicate code</div>
<div class="line">        uses: platisd/duplicate-code-detection-tool@master</div>
<div class="line">        with:</div>
<div class="line">          github_token: ${{ secrets.GITHUB_TOKEN }}</div>
<div class="line">          directories: &quot;src&quot;</div>
<div class="line">          # Ignore the specified directories</div>
<div class="line">          ignore_directories: &quot;src/external_libraries&quot;</div>
<div class="line">          # Only examine .h and .cpp files</div>
<div class="line">          file_extensions: &quot;h, cpp&quot;</div>
<div class="line">          # Only report similarities above 5%</div>
<div class="line">          ignore_below: 5</div>
<div class="line">          # If a file is more than 70% similar to another, then the job fails</div>
<div class="line">          fail_above: 70</div>
<div class="line">          # If a file is more than 15% similar to another, show a warning symbol in the report</div>
<div class="line">          warn_above: 15</div>
<div class="line">          # Remove `src/` from the file paths when reporting similarities</div>
<div class="line">          project_root_dir: &quot;src&quot;</div>
<div class="line">          # Remove docstrings from code before analysis</div>
<div class="line">          # For python source code only. This is checked on a per-file basis</div>
<div class="line">          only_code: true</div>
<div class="line">          # Leave only one comment with the report and update it for consecutive runs</div>
<div class="line">          one_comment: true</div>
<div class="line">          # The message to be displayed at the start of the report</div>
<div class="line">          header_message_start: &quot;The following files have a similarity above the threshold:&quot;</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md21"></a>
Using duplicate-code-check with pre-commit</h1>
<p>To use Duplicate Code Detection Tool as a pre-commit hook with <a href="https://pre-commit.com/">pre-commit</a> add the following to your <code>.pre-commit-config.yaml</code> file: </p><div class="fragment"><div class="line">-   repo: https://github.com/platisd/duplicate-code-detection-tool.git</div>
<div class="line">    rev: &#39;&#39;  # Use the sha / tag you want to point at</div>
<div class="line">    hooks:</div>
<div class="line">    -   id: duplicate-code-detection</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>**_NOTE:_** that this repository sets args: <code>-f</code>, if you are configuring duplicate-code-detection-tool using args you'll want to include either <code>-f</code> (<code>--files</code>) or <code>-d</code> (<code>--directories</code>). </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md22"></a>
Limitations</h1>
<ul>
<li><code>only_code</code> option only works with python files for now </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_3202f631f77a4212868956406c49ad8f.html">arkanjo</a></li><li class="navelem"><a class="el" href="dir_52d0f11198f0068e2be6e37fca9a566b.html">third-party</a></li><li class="navelem"><a class="el" href="dir_a38776f5d37043d26fa945a889a3220c.html">duplicate-code-detection-tool</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
